<!doctype html><html class="" data-reactroot=""><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="Use this template to create a Pagic site with the blog theme."/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">斐讯N1 docker安装homeassistant  配置斐讯dc1智能插座 · pagic template</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><a class="czs-menu-l show_on_mobile aside_button_open" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a><a class="show_on_mobile aside_button_text" href="/">pagic template</a><aside class="hide_on_mobile"><div class="aside_card"><a class="czs-menu-l show_on_mobile aside_button_close" href="#" style="background-image:url(&quot;/assets/czs-close-l.svg&quot;)"></a><h1><a href="/">pagic template</a></h1><p class="description">Use this template to create a Pagic site with the blog theme.</p><ul class="social list_style_none"><li class="flex_center"><a class="czs-github-logo" href="https://github.com/waimao8/pagic_template" target="_blank" style="background-image:url(&quot;/assets/czs-github-logo.svg&quot;)"></a></li><li class="flex_center"><a class="czs-message-l" href="mailto:huqi@gpdi.com" target="_blank" style="background-image:url(&quot;/assets/czs-message-l.svg&quot;)"></a></li><li class="flex_center"><a class="czs-twitter" href="https://twitter.com/huqii" target="_blank" style="background-image:url(&quot;/assets/czs-twitter.svg&quot;)"></a></li><li class="flex_center"><a class="czs-v2ex" href="https://v2ex.com/member/huqi" target="_blank" style="background-image:url(&quot;/assets/czs-v2ex.svg&quot;)"></a></li><li class="flex_center"><a class="czs-zhihu" href="https://www.zhihu.com/people/fashaoge" target="_blank" style="background-image:url(&quot;/assets/czs-zhihu.svg&quot;)"></a></li><li style="flex-grow:1"></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul><nav><ul class="menu list_style_none"><li><a class="flex_center" href="/index.html"><span class="czs-home-l" style="background-image:url(&quot;/assets/czs-home-l.svg&quot;)"></span>Homepage</a></li><li><a class="flex_center" href="/categories/index.html"><span class="czs-category-l" style="background-image:url(&quot;/assets/czs-category-l.svg&quot;)"></span>Categories</a></li><li><a class="flex_center" href="/tags/index.html"><span class="czs-tag-l" style="background-image:url(&quot;/assets/czs-tag-l.svg&quot;)"></span>Tags</a></li><li><a class="flex_center" href="/about/index.html"><span class="czs-about-l" style="background-image:url(&quot;/assets/czs-about-l.svg&quot;)"></span>About</a></li><li><a class="flex_center" href="/archives/index.html"><span class="czs-box-l" style="background-image:url(&quot;/assets/czs-box-l.svg&quot;)"></span>Archives</a></li><li><a class="flex_center" href="/links/index.html"><span class="czs-link-l" style="background-image:url(&quot;/assets/czs-link-l.svg&quot;)"></span>Friends</a></li></ul></nav></div></aside><section class="main"><div class="main_post_meta"><time dateTime="Mon Sep 16 2019 20:52:42 GMT+0800 (CST)">2019-09-17</time> · <!-- -->unknown</div><article><p>斐讯N1 docker安装homeassistant  配置斐讯dc1智能插座</p>
<p>默认代码</p>
<pre class="language-autoit"><code class="language-autoit">docker run <span class="token operator">-</span>d <span class="token operator">-</span><span class="token operator">-</span>restart<span class="token operator">=</span>always <span class="token operator">-</span><span class="token operator">-</span>name<span class="token operator">=</span><span class="token string">"home-assistant"</span> <span class="token operator">-</span>e TZ<span class="token operator">=</span>Asia<span class="token operator">/</span>Shanghai <span class="token operator">-</span>v <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>docker<span class="token operator">/</span>homeassistant<span class="token punctuation">:</span><span class="token operator">/</span>config <span class="token operator">-</span>p <span class="token number">8123</span><span class="token punctuation">:</span><span class="token number">8123</span> <span class="token operator">-</span>v <span class="token operator">/</span>etc<span class="token operator">/</span>localtime<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>localtime<span class="token punctuation">:</span>ro <span class="token operator">-</span><span class="token operator">-</span>net<span class="token operator">=</span>host homeassistant<span class="token operator">/</span>aarch64<span class="token operator">-</span>homeassistant<span class="token punctuation">:</span>latest

</code></pre>
<!-- more -->
<p>homeassistant:latest表示最新版的 用0.88.1顺手了，配置文件也有了，就不想安装最新版本的了。新版也试用过，不太好用<br>
刚开始用的代码是</p>
<pre class="language-autoit"><code class="language-autoit">docker run <span class="token operator">-</span>d <span class="token operator">-</span><span class="token operator">-</span>restart<span class="token operator">=</span>always <span class="token operator">-</span><span class="token operator">-</span>name<span class="token operator">=</span><span class="token string">"home-assistant"</span> <span class="token operator">-</span>e TZ<span class="token operator">=</span>Asia<span class="token operator">/</span>Shanghai <span class="token operator">-</span>v <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>docker<span class="token operator">/</span>homeassistant<span class="token punctuation">:</span><span class="token operator">/</span>config <span class="token operator">-</span>p <span class="token number">8123</span><span class="token punctuation">:</span><span class="token number">8123</span> <span class="token operator">-</span>v <span class="token operator">/</span>etc<span class="token operator">/</span>localtime<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>localtime<span class="token punctuation">:</span>ro <span class="token operator">-</span><span class="token operator">-</span>net<span class="token operator">=</span>host homeassistant<span class="token operator">/</span>aarch64<span class="token operator">-</span>homeassistant<span class="token punctuation">:</span><span class="token number">0.88</span><span class="token punctuation">.</span><span class="token number">1</span>

</code></pre>
<p>没几天发现N1omv不能登陆，查询到内存储存已满，查找到var/lib/docker/homeassistant/config 里面有一个home-assistant_v2.db文件占了2G多，而且会不断的变大，更改 /docker/homeassistant的安装目录到移动硬盘<br>
这个是我的docker的安装目录，/sharedfolders/2t/docker<br>
所以修改后的代码就是把/var/lib/docker更换成/sharedfolders/2t/docker</p>
<pre class="language-autoit"><code class="language-autoit">docker run <span class="token operator">-</span>d <span class="token operator">-</span><span class="token operator">-</span>restart<span class="token operator">=</span>always <span class="token operator">-</span><span class="token operator">-</span>name<span class="token operator">=</span><span class="token string">"home-assistant"</span> <span class="token operator">-</span>e TZ<span class="token operator">=</span>Asia<span class="token operator">/</span>Shanghai <span class="token operator">-</span>v <span class="token operator">/</span>sharedfolders<span class="token operator">/</span>2t<span class="token operator">/</span>docker<span class="token operator">/</span>homeassistant<span class="token punctuation">:</span><span class="token operator">/</span>config <span class="token operator">-</span>p <span class="token number">8123</span><span class="token punctuation">:</span><span class="token number">8123</span> <span class="token operator">-</span>v <span class="token operator">/</span>etc<span class="token operator">/</span>localtime<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>localtime<span class="token punctuation">:</span>ro <span class="token operator">-</span><span class="token operator">-</span>net<span class="token operator">=</span>host homeassistant<span class="token operator">/</span>aarch64<span class="token operator">-</span>homeassistant<span class="token punctuation">:</span><span class="token number">0.88</span><span class="token punctuation">.</span><span class="token number">1</span>

</code></pre>
<p>下载DCI配网工具
给DC1配置好网络，要在路由里面找到DC1的ip就算完成了</p>
<p>下载 20190628 HA Docker - DC1 M1.rar 里面有配置说明的<br>
蓝奏云网盘下载 <a href="https://www.lanzous.com/b987569">https://www.lanzous.com/b987569</a><br>
下载的文件里面有配置说明的，我也简单说下，把custom_components、M1（悟空净化器）、packages上传到/homeassistant根目录，下面内容复制进configuration.yaml底部<br>
homeassistant:<br>
packages: !include_dir_named packages<br>
斐讯K2老毛子固件路由。高级设置，内部网络，DHCP服务器，自定义配置文件 “hosts”<br>
增加以下两句<br>
192.168.123.24 <a href="http://Smartplugconnect.phicomm.com">Smartplugconnect.phicomm.com</a><br>
192.168.123.24 <a href="http://aircat.phicomm.com">aircat.phicomm.com</a><br>
备注：192.168.123.24是我的斐讯N1的ip<br>
修改packages/phicomm_dc1m.yaml<br>
ip修改成你在路由器里面看到DC1的ip</p>
<p>配置根目录的automations.yaml<br>
我设置了饮水机06.30开 00.30关 打印机18.00开 00.00关，下面是代码</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token operator">-</span> alias<span class="token punctuation">:</span> switch_on <span class="token number">06.30</span>
  initial_state<span class="token punctuation">:</span> <span class="token boolean">true</span>
  trigger<span class="token punctuation">:</span>
  <span class="token operator">-</span> platform<span class="token punctuation">:</span> time
    at<span class="token punctuation">:</span> <span class="token string">'06:30:00'</span>
  action<span class="token punctuation">:</span>
  <span class="token operator">-</span> service<span class="token punctuation">:</span> <span class="token keyword">switch</span><span class="token punctuation">.</span>turn_on 
    entity_id<span class="token punctuation">:</span> <span class="token keyword">switch</span><span class="token punctuation">.</span>dc1_s1_template
<span class="token operator">-</span> alias<span class="token punctuation">:</span> switch_off <span class="token number">00.30</span>
  initial_state<span class="token punctuation">:</span> <span class="token boolean">true</span>
  trigger<span class="token punctuation">:</span>
  <span class="token operator">-</span> platform<span class="token punctuation">:</span> time
    at<span class="token punctuation">:</span> <span class="token string">'00:30:00'</span>
  action<span class="token punctuation">:</span>
  <span class="token operator">-</span> service<span class="token punctuation">:</span> <span class="token keyword">switch</span><span class="token punctuation">.</span>turn_off
    entity_id<span class="token punctuation">:</span> <span class="token keyword">switch</span><span class="token punctuation">.</span>dc1_s1_template


<span class="token operator">-</span> alias<span class="token punctuation">:</span> switch_on <span class="token number">18.00</span>
  initial_state<span class="token punctuation">:</span> <span class="token boolean">true</span>
  trigger<span class="token punctuation">:</span>
  <span class="token operator">-</span> platform<span class="token punctuation">:</span> time
    at<span class="token punctuation">:</span> <span class="token string">'18:00:00'</span>
  action<span class="token punctuation">:</span>
  <span class="token operator">-</span> service<span class="token punctuation">:</span> <span class="token keyword">switch</span><span class="token punctuation">.</span>turn_on
    entity_id<span class="token punctuation">:</span> <span class="token keyword">switch</span><span class="token punctuation">.</span>dc1_3_s3_template
<span class="token operator">-</span> alias<span class="token punctuation">:</span> switch_off <span class="token number">00.00</span>
  initial_state<span class="token punctuation">:</span> <span class="token boolean">true</span>
  trigger<span class="token punctuation">:</span>
  <span class="token operator">-</span> platform<span class="token punctuation">:</span> time
    at<span class="token punctuation">:</span> <span class="token string">'00:00:00'</span>
  action<span class="token punctuation">:</span>
  <span class="token operator">-</span> service<span class="token punctuation">:</span> <span class="token keyword">switch</span><span class="token punctuation">.</span>turn_off
    entity_id<span class="token punctuation">:</span> <span class="token keyword">switch</span><span class="token punctuation">.</span>dc1_3_s3_template


</code></pre>
<p>配置过程发现问题解决的的3个方法<br>
1、斐讯DCI拔插头断电，再接电<br>
2、重启homeassistant<br>
3、退出homeassistant账户，重新登陆</p>
<p>可以在docker重启homeassistant ，也可以在网页重启，配置好文件后可以按下图更改，0.88.1配置是这样的，新版貌似没有配置检查。<br>
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDkvMTYvNzFxSWZnT2N0WFFFckI1LnBuZw?x-oss-process=image/format,png" alt="dc1配置.png"></p></article></section><footer>Powered by <a href="https://github.com/xcatliu/pagic" target="_blank">Pagic</a></footer><script src="https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js"></script><script src="https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>