<!doctype html><html class="" data-reactroot=""><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="Use this template to create a Pagic site with the blog theme."/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">n1终极玩法Armbian-5.77安装docker宝塔openwrt和HomeAssistant · pagic template</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><a class="czs-menu-l show_on_mobile aside_button_open" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a><a class="show_on_mobile aside_button_text" href="/">pagic template</a><aside class="hide_on_mobile"><div class="aside_card"><a class="czs-menu-l show_on_mobile aside_button_close" href="#" style="background-image:url(&quot;/assets/czs-close-l.svg&quot;)"></a><h1><a href="/">pagic template</a></h1><p class="description">Use this template to create a Pagic site with the blog theme.</p><ul class="social list_style_none"><li class="flex_center"><a class="czs-github-logo" href="https://github.com/waimao8/pagic_template" target="_blank" style="background-image:url(&quot;/assets/czs-github-logo.svg&quot;)"></a></li><li class="flex_center"><a class="czs-message-l" href="mailto:huqi@gpdi.com" target="_blank" style="background-image:url(&quot;/assets/czs-message-l.svg&quot;)"></a></li><li class="flex_center"><a class="czs-twitter" href="https://twitter.com/huqii" target="_blank" style="background-image:url(&quot;/assets/czs-twitter.svg&quot;)"></a></li><li class="flex_center"><a class="czs-v2ex" href="https://v2ex.com/member/huqi" target="_blank" style="background-image:url(&quot;/assets/czs-v2ex.svg&quot;)"></a></li><li class="flex_center"><a class="czs-zhihu" href="https://www.zhihu.com/people/fashaoge" target="_blank" style="background-image:url(&quot;/assets/czs-zhihu.svg&quot;)"></a></li><li style="flex-grow:1"></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul><nav><ul class="menu list_style_none"><li><a class="flex_center" href="/index.html"><span class="czs-home-l" style="background-image:url(&quot;/assets/czs-home-l.svg&quot;)"></span>Homepage</a></li><li><a class="flex_center" href="/categories/index.html"><span class="czs-category-l" style="background-image:url(&quot;/assets/czs-category-l.svg&quot;)"></span>Categories</a></li><li><a class="flex_center" href="/tags/index.html"><span class="czs-tag-l" style="background-image:url(&quot;/assets/czs-tag-l.svg&quot;)"></span>Tags</a></li><li><a class="flex_center" href="/about/index.html"><span class="czs-about-l" style="background-image:url(&quot;/assets/czs-about-l.svg&quot;)"></span>About</a></li><li><a class="flex_center" href="/archives/index.html"><span class="czs-box-l" style="background-image:url(&quot;/assets/czs-box-l.svg&quot;)"></span>Archives</a></li><li><a class="flex_center" href="/links/index.html"><span class="czs-link-l" style="background-image:url(&quot;/assets/czs-link-l.svg&quot;)"></span>Friends</a></li></ul></nav></div></aside><section class="main"><h1>安装Armbian-5.77</h1><div class="main_post_meta"><time dateTime="Tue Jun 02 2020 23:55:32 GMT+0800 (CST)">2020-06-03</time> · <!-- -->unknown</div><article><p><a href="https://www.right.com.cn/forum/thread-510423-1-1.html">https://www.right.com.cn/forum/thread-510423-1-1.html</a></p>
<h2 id="%E4%B8%8B%E8%BD%BDarmbian-577%E5%86%99%E5%85%A5u%E7%9B%98">下载Armbian-5.77写入U盘<a class="anchor" href="#%E4%B8%8B%E8%BD%BDarmbian-577%E5%86%99%E5%85%A5u%E7%9B%98">§</a></h2>
<h2 id="%E6%9B%BF%E6%8D%A2%E4%BD%8E%E8%B4%9F%E8%BD%BD%E7%9A%84dtb">替换低负载的dtb<a class="anchor" href="#%E6%9B%BF%E6%8D%A2%E4%BD%8E%E8%B4%9F%E8%BD%BD%E7%9A%84dtb">§</a></h2>
<p>meson-gxl-s905d-phicomm-n1-xiangsm.dtb</p>
<h2 id="%E5%BC%80%E5%90%AFbbr">开启bbr<a class="anchor" href="#%E5%BC%80%E5%90%AFbbr">§</a></h2>
<p>在/etc/sysctl.conf末尾添加下面两行:<br>
net.core.default_qdisc=fq
net.ipv4.tcp_congestion_control=bbr<br>
然后执行<br>
sudo sysctl -p</p>
<h2 id="%E5%86%99%E5%85%A5emmc">写入emmc<a class="anchor" href="#%E5%86%99%E5%85%A5emmc">§</a></h2>
<p>./install.sh</p>
<h2 id="%E6%9B%B4%E6%8D%A2%E5%9B%BD%E5%86%85%E6%BA%90">更换国内源<a class="anchor" href="#%E6%9B%B4%E6%8D%A2%E5%9B%BD%E5%86%85%E6%BA%90">§</a></h2>
<p>如果有外国IP就不用更换源了<br>
sudo nano /etc/apt/sources.list</p>
<p>修改源为国内源
deb <a href="http://mirrors.tuna.tsinghua.edu.cndebian">http://mirrors.tuna.tsinghua.edu.cndebian</a> stretch main contrib non-free<br>
deb <a href="http://mirrors.tuna.tsinghua.edu.cn/debian">http://mirrors.tuna.tsinghua.edu.cn/debian</a> stretch-updates main contrib non-free<br>
deb <a href="http://mirrors.tuna.tsinghua.edu.cn/debian-security">http://mirrors.tuna.tsinghua.edu.cn/debian-security</a> stretch/updates main contrib non-free<br>
deb <a href="http://mirrors.tuna.tsinghua.edu.cn/debian">http://mirrors.tuna.tsinghua.edu.cn/debian</a> stretch-backports main</p>
<p>保存后，更新源<br>
执行 apt-get update 命令即可更新源<br>
执行 apt-get upgrade 更新软件</p>
<h2 id="%E5%AE%89%E8%A3%85docker">安装docker<a class="anchor" href="#%E5%AE%89%E8%A3%85docker">§</a></h2>
<p>输入 armbian-config<br>
选择Software，回车确认 接着选择Softy，回车确认 最后选择docker，空格勾选，回车确认开始安装<br>
然后，按tab键，选择OK，回车确认 最后等docker程序自动安装完成</p>
<h2 id="docker%E5%AE%89%E8%A3%85portainer">docker安装portainer<a class="anchor" href="#docker%E5%AE%89%E8%A3%85portainer">§</a></h2>
<p>docker pull portainer/portainer<br>
docker run -d -p 9888:9000 -v /var/run/docker.sock:/var/run/docker.sock --restart=always --name prtainer portainer/portainer<br>
如果遇到安装失败一般都是源的问题，换IP可以解决</p>
<h2 id="%E6%8C%82%E8%BD%BDdocker%E6%95%B0%E6%8D%AE%E5%88%B0%E6%95%B0%E6%8D%AE%E7%9B%98">挂载docker数据到数据盘<a class="anchor" href="#%E6%8C%82%E8%BD%BDdocker%E6%95%B0%E6%8D%AE%E5%88%B0%E6%95%B0%E6%8D%AE%E7%9B%98">§</a></h2>
<p>考虑到N1只有6G可用储存，我们可以将dockers安装到数据盘，接入U盘或者硬盘，输入<br>
df -i，比如查询硬盘为  /dev/sda1<br>
将硬盘挂载到mnt （其他目录也可以）
输入mount /dev/sda1 /mnt<br>
输入 blkid /dev/sda1 查询 得到数据<br>
UUID=&quot;a78e3c99-2754-034e-abd1-36后面省略<br>
输入命令开机自动挂载<br>
echo 'UUID=a78e3c99-2754-034e-abd1-36后面省略 /mnt ext4 defaults 0 0' &gt;&gt; /etc/fstab<br>
输入 mount -a<br>
检查是否挂载好  df -h<br>
备份docker数据<br>
cp -r /var/lib/docker_data /var/lib/docker<br>
移动docker数据到硬盘<br>
mv /var/lib/docker /mnt/docker<br>
把硬盘的目录发送到N1<br>
ln -s /mnt/docker /var/lib/docker</p>
<h2 id="docker%E5%AE%89%E8%A3%85openwrt">docker安装openwrt<a class="anchor" href="#docker%E5%AE%89%E8%A3%85openwrt">§</a></h2>
<p>docker pull unifreq/openwrt-aarch64:r20.04.08<br>
ip link set eth0 promisc on<br>
modprobe pppoe<br>
docker network create -d macvlan --subnet=192.168.123.0/24 --gateway=192.168.123.1 -o parent=eth0 macnet<br>
docker run --restart always -d --network macnet --privileged --ip=192.168.123.2 unifreq/openwrt-aarch64:r20.04.08 /sbin/init<br>
大家根据自己的实际IP改下代码<br>
再登录portainer管理页面，点container<br>
vi /etc/config/network<br>
按i改网关信息，op的ip要改成跟主路由同网关，比如192.168.123.2或者192.168.123.3，改好后依次按返回键，:wq保存退出。再点disconnect，在containers那勾选op 点restart重启op。 (部分op需手动复制粘贴以下两条<br>
192.168.2.1改成你主路由ip。不复制进去就登陆不了op<br>
option gateway '192.168.123.1'<br>
option dns '114.114.114.114 223.5.5.5'<br>
另外再教大家安装下载好的openwrt<br>
导入本地编译好的rootfs.tar.gz并部署<br>
随便导入一个文件夹  cd /到这个文件夹<br>
docker import openwrt-armvirt-64-default-rootfs.tar.gz openwrt:R9.9.15<br>
再输入<br>
docker run --restart always -d --network macnet --privileged --ip=192.168.123.5 openwrt:R9.9.15 /sbin/init<br>
vi /etc/config/network<br>
设置网关为192.168.123.5<br>
重启openwrt 输入192.168.123.5 就可以登陆了<br>
默认的账号root 密码password</p>
<h1>安装Home Assistant</h1>
<p>docker run -d --restart=always --name=&quot;home-assistant&quot; -e TZ=Asia/Shanghai -v /var/lib/docker/homeassistant:/config -p 8123:8123 -v /etc/localtime:/etc/localtime:ro --net=host homeassistant/aarch64-homeassistant:0.88.1</p>
<p>具体参考另一篇文章<br>
<a href="https://163168.xyz/posts/6.html">https://163168.xyz/posts/6.html</a></p>
<h1>安装宝塔搭建网站</h1>
<p>安装过程直接看这里<br>
<a href="https://hub.docker.com/r/startwish/n1-bt-lnmp">https://hub.docker.com/r/startwish/n1-bt-lnmp</a></p>
<p>默认的信息
宝塔面板登录页面是</p>
<p>你的IP:8888/startwish
账号startwish</p>
<p>密码startwish</p>
<p>系统root账户的密码是startwish<br>
可以通过宝塔搭建自己的网站了！！！</p></article></section><footer>Powered by <a href="https://github.com/xcatliu/pagic" target="_blank">Pagic</a></footer><script src="https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js"></script><script src="https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>